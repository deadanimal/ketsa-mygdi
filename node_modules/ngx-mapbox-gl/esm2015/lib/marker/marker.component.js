import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Input, Output, ViewChild, ViewEncapsulation, } from '@angular/core';
import { MapService } from '../map/map.service';
import { deprecationWarning } from '../utils';
export class MarkerComponent {
    constructor(MapService) {
        this.MapService = MapService;
        this.markerDragStart = new EventEmitter();
        this.markerDragEnd = new EventEmitter();
        this.markerDrag = new EventEmitter();
        /**
         * @deprecated Use markerDragStart instead
         */
        this.dragStart = new EventEmitter();
        /**
         * @deprecated Use markerDragEnd instead
         */
        this.dragEnd = new EventEmitter();
        /**
         * @deprecated Use markerDrag instead
         */
        this.drag = new EventEmitter();
    }
    ngOnInit() {
        this.warnDeprecatedOutputs();
        if (this.feature && this.lngLat) {
            throw new Error('feature and lngLat input are mutually exclusive');
        }
    }
    ngOnChanges(changes) {
        if (changes.lngLat && !changes.lngLat.isFirstChange()) {
            this.markerInstance.setLngLat(this.lngLat);
        }
        if (changes.feature && !changes.feature.isFirstChange()) {
            this.markerInstance.setLngLat(this.feature.geometry.coordinates);
        }
        if (changes.draggable && !changes.draggable.isFirstChange()) {
            this.markerInstance.setDraggable(!!this.draggable);
        }
        if (changes.popupShown && !changes.popupShown.isFirstChange()) {
            changes.popupShown.currentValue
                ? this.markerInstance.getPopup().addTo(this.MapService.mapInstance)
                : this.markerInstance.getPopup().remove();
        }
        if (changes.pitchAlignment && !changes.pitchAlignment.isFirstChange()) {
            this.markerInstance.setPitchAlignment(changes.pitchAlignment.currentValue);
        }
        if (changes.rotationAlignment &&
            !changes.rotationAlignment.isFirstChange()) {
            this.markerInstance.setRotationAlignment(changes.rotationAlignment.currentValue);
        }
    }
    ngAfterViewInit() {
        this.MapService.mapCreated$.subscribe(() => {
            this.markerInstance = this.MapService.addMarker({
                markersOptions: {
                    offset: this.offset,
                    anchor: this.anchor,
                    pitchAlignment: this.pitchAlignment,
                    rotationAlignment: this.rotationAlignment,
                    draggable: !!this.draggable,
                    element: this.content.nativeElement,
                    feature: this.feature,
                    lngLat: this.lngLat,
                    clickTolerance: this.clickTolerance,
                },
                markersEvents: {
                    markerDragStart: this.markerDragStart,
                    markerDrag: this.markerDrag,
                    markerDragEnd: this.markerDragEnd,
                    dragStart: this.dragStart,
                    drag: this.drag,
                    dragEnd: this.dragEnd,
                },
            });
        });
    }
    ngOnDestroy() {
        this.MapService.removeMarker(this.markerInstance);
        this.markerInstance = undefined;
    }
    togglePopup() {
        this.markerInstance.togglePopup();
    }
    updateCoordinates(coordinates) {
        this.markerInstance.setLngLat(coordinates);
    }
    warnDeprecatedOutputs() {
        const dw = deprecationWarning.bind(undefined, MarkerComponent.name);
        if (this.dragStart.observers.length) {
            dw('dragStart', 'markerDragStart');
        }
        if (this.dragEnd.observers.length) {
            dw('dragEnd', 'markerDragEnd');
        }
        if (this.drag.observers.length) {
            dw('drag', 'markerDrag');
        }
    }
}
MarkerComponent.decorators = [
    { type: Component, args: [{
                selector: 'mgl-marker',
                template: '<div [class]="className" #content><ng-content></ng-content></div>',
                encapsulation: ViewEncapsulation.None,
                changeDetection: ChangeDetectionStrategy.OnPush
            },] }
];
MarkerComponent.ctorParameters = () => [
    { type: MapService }
];
MarkerComponent.propDecorators = {
    offset: [{ type: Input }],
    anchor: [{ type: Input }],
    clickTolerance: [{ type: Input }],
    feature: [{ type: Input }],
    lngLat: [{ type: Input }],
    draggable: [{ type: Input }],
    popupShown: [{ type: Input }],
    className: [{ type: Input }],
    pitchAlignment: [{ type: Input }],
    rotationAlignment: [{ type: Input }],
    markerDragStart: [{ type: Output }],
    markerDragEnd: [{ type: Output }],
    markerDrag: [{ type: Output }],
    dragStart: [{ type: Output }],
    dragEnd: [{ type: Output }],
    drag: [{ type: Output }],
    content: [{ type: ViewChild, args: ['content', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1tYXBib3gtZ2wvc3JjL2xpYi9tYXJrZXIvbWFya2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFJTCxNQUFNLEVBRU4sU0FBUyxFQUNULGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBUTlDLE1BQU0sT0FBTyxlQUFlO0lBb0MxQixZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBcEJoQyxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFDN0Msa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQzNDLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQ2xEOztXQUVHO1FBQ08sY0FBUyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFDakQ7O1dBRUc7UUFDTyxZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUMvQzs7V0FFRztRQUNPLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO0lBTUMsQ0FBQztJQUU5QyxRQUFRO1FBQ04sSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDN0IsSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDL0IsTUFBTSxJQUFJLEtBQUssQ0FBQyxpREFBaUQsQ0FBQyxDQUFDO1NBQ3BFO0lBQ0gsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLElB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RU4sU0FBUyxTQUFDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEFmdGVyVmlld0luaXQsXHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXHJcbiAgQ29tcG9uZW50LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG4gIE91dHB1dCxcclxuICBTaW1wbGVDaGFuZ2VzLFxyXG4gIFZpZXdDaGlsZCxcclxuICBWaWV3RW5jYXBzdWxhdGlvbixcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTG5nTGF0TGlrZSwgTWFya2VyLCBNYXJrZXJPcHRpb25zIH0gZnJvbSAnbWFwYm94LWdsJztcclxuaW1wb3J0IHsgTWFwU2VydmljZSB9IGZyb20gJy4uL21hcC9tYXAuc2VydmljZSc7XHJcbmltcG9ydCB7IGRlcHJlY2F0aW9uV2FybmluZyB9IGZyb20gJy4uL3V0aWxzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbWdsLW1hcmtlcicsXHJcbiAgdGVtcGxhdGU6ICc8ZGl2IFtjbGFzc109XCJjbGFzc05hbWVcIiAjY29udGVudD48bmctY29udGVudD48L25nLWNvbnRlbnQ+PC9kaXY+JyxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgTWFya2VyQ29tcG9uZW50XHJcbiAgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCwgT25Jbml0IHtcclxuICAvKiBJbml0IGlucHV0ICovXHJcbiAgQElucHV0KCkgb2Zmc2V0PzogTWFya2VyT3B0aW9uc1snb2Zmc2V0J107XHJcbiAgQElucHV0KCkgYW5jaG9yPzogTWFya2VyT3B0aW9uc1snYW5jaG9yJ107XHJcbiAgQElucHV0KCkgY2xpY2tUb2xlcmFuY2U/OiBNYXJrZXJPcHRpb25zWydjbGlja1RvbGVyYW5jZSddO1xyXG5cclxuICAvKiBEeW5hbWljIGlucHV0ICovXHJcbiAgQElucHV0KCkgZmVhdHVyZT86IEdlb0pTT04uRmVhdHVyZTxHZW9KU09OLlBvaW50PjtcclxuICBASW5wdXQoKSBsbmdMYXQ/OiBMbmdMYXRMaWtlO1xyXG4gIEBJbnB1dCgpIGRyYWdnYWJsZT86IE1hcmtlck9wdGlvbnNbJ2RyYWdnYWJsZSddO1xyXG4gIEBJbnB1dCgpIHBvcHVwU2hvd24/OiBib29sZWFuO1xyXG4gIEBJbnB1dCgpIGNsYXNzTmFtZTogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHBpdGNoQWxpZ25tZW50PzogTWFya2VyT3B0aW9uc1sncGl0Y2hBbGlnbm1lbnQnXTtcclxuICBASW5wdXQoKSByb3RhdGlvbkFsaWdubWVudD86IE1hcmtlck9wdGlvbnNbJ3JvdGF0aW9uQWxpZ25tZW50J107XHJcblxyXG4gIEBPdXRwdXQoKSBtYXJrZXJEcmFnU3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyPE1hcmtlcj4oKTtcclxuICBAT3V0cHV0KCkgbWFya2VyRHJhZ0VuZCA9IG5ldyBFdmVudEVtaXR0ZXI8TWFya2VyPigpO1xyXG4gIEBPdXRwdXQoKSBtYXJrZXJEcmFnID0gbmV3IEV2ZW50RW1pdHRlcjxNYXJrZXI+KCk7XHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWQgVXNlIG1hcmtlckRyYWdTdGFydCBpbnN0ZWFkXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIGRyYWdTdGFydCA9IG5ldyBFdmVudEVtaXR0ZXI8TWFya2VyPigpO1xyXG4gIC8qKlxyXG4gICAqIEBkZXByZWNhdGVkIFVzZSBtYXJrZXJEcmFnRW5kIGluc3RlYWRcclxuICAgKi9cclxuICBAT3V0cHV0KCkgZHJhZ0VuZCA9IG5ldyBFdmVudEVtaXR0ZXI8TWFya2VyPigpO1xyXG4gIC8qKlxyXG4gICAqIEBkZXByZWNhdGVkIFVzZSBtYXJrZXJEcmFnIGluc3RlYWRcclxuICAgKi9cclxuICBAT3V0cHV0KCkgZHJhZyA9IG5ldyBFdmVudEVtaXR0ZXI8TWFya2VyPigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdjb250ZW50JywgeyBzdGF0aWM6IHRydWUgfSkgY29udGVudDogRWxlbWVudFJlZjtcclxuXHJcbiAgbWFya2VySW5zdGFuY2U/OiBNYXJrZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgTWFwU2VydmljZTogTWFwU2VydmljZSkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLndhcm5EZXByZWNhdGVkT3V0cHV0cygpO1xyXG4gICAgaWYgKHRoaXMuZmVhdHVyZSAmJiB0aGlzLmxuZ0xhdCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZlYXR1cmUgYW5kIGxuZ0xhdCBpbnB1dCBhcmUgbXV0dWFsbHkgZXhjbHVzaXZlJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBpZiAoY2hhbmdlcy5sbmdMYXQgJiYgIWNoYW5nZXMubG5nTGF0LmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICB0aGlzLm1hcmtlckluc3RhbmNlIS5zZXRMbmdMYXQodGhpcy5sbmdMYXQhKTtcclxuICAgIH1cclxuICAgIGlmIChjaGFuZ2VzLmZlYXR1cmUgJiYgIWNoYW5nZXMuZmVhdHVyZS5pc0ZpcnN0Q2hhbmdlKCkpIHtcclxuICAgICAgdGhpcy5tYXJrZXJJbnN0YW5jZSEuc2V0TG5nTGF0KFxyXG4gICAgICAgIDxbbnVtYmVyLCBudW1iZXJdPnRoaXMuZmVhdHVyZSEuZ2VvbWV0cnkhLmNvb3JkaW5hdGVzXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBpZiAoY2hhbmdlcy5kcmFnZ2FibGUgJiYgIWNoYW5nZXMuZHJhZ2dhYmxlLmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICB0aGlzLm1hcmtlckluc3RhbmNlIS5zZXREcmFnZ2FibGUoISF0aGlzLmRyYWdnYWJsZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoY2hhbmdlcy5wb3B1cFNob3duICYmICFjaGFuZ2VzLnBvcHVwU2hvd24uaXNGaXJzdENoYW5nZSgpKSB7XHJcbiAgICAgIGNoYW5nZXMucG9wdXBTaG93bi5jdXJyZW50VmFsdWVcclxuICAgICAgICA/IHRoaXMubWFya2VySW5zdGFuY2UhLmdldFBvcHVwKCkuYWRkVG8odGhpcy5NYXBTZXJ2aWNlLm1hcEluc3RhbmNlKVxyXG4gICAgICAgIDogdGhpcy5tYXJrZXJJbnN0YW5jZSEuZ2V0UG9wdXAoKS5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIGlmIChjaGFuZ2VzLnBpdGNoQWxpZ25tZW50ICYmICFjaGFuZ2VzLnBpdGNoQWxpZ25tZW50LmlzRmlyc3RDaGFuZ2UoKSkge1xyXG4gICAgICB0aGlzLm1hcmtlckluc3RhbmNlIS5zZXRQaXRjaEFsaWdubWVudChcclxuICAgICAgICBjaGFuZ2VzLnBpdGNoQWxpZ25tZW50LmN1cnJlbnRWYWx1ZVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgaWYgKFxyXG4gICAgICBjaGFuZ2VzLnJvdGF0aW9uQWxpZ25tZW50ICYmXHJcbiAgICAgICFjaGFuZ2VzLnJvdGF0aW9uQWxpZ25tZW50LmlzRmlyc3RDaGFuZ2UoKVxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXMubWFya2VySW5zdGFuY2UhLnNldFJvdGF0aW9uQWxpZ25tZW50KFxyXG4gICAgICAgIGNoYW5nZXMucm90YXRpb25BbGlnbm1lbnQuY3VycmVudFZhbHVlXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICB0aGlzLk1hcFNlcnZpY2UubWFwQ3JlYXRlZCQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy5tYXJrZXJJbnN0YW5jZSA9IHRoaXMuTWFwU2VydmljZS5hZGRNYXJrZXIoe1xyXG4gICAgICAgIG1hcmtlcnNPcHRpb25zOiB7XHJcbiAgICAgICAgICBvZmZzZXQ6IHRoaXMub2Zmc2V0LFxyXG4gICAgICAgICAgYW5jaG9yOiB0aGlzLmFuY2hvcixcclxuICAgICAgICAgIHBpdGNoQWxpZ25tZW50OiB0aGlzLnBpdGNoQWxpZ25tZW50LFxyXG4gICAgICAgICAgcm90YXRpb25BbGlnbm1lbnQ6IHRoaXMucm90YXRpb25BbGlnbm1lbnQsXHJcbiAgICAgICAgICBkcmFnZ2FibGU6ICEhdGhpcy5kcmFnZ2FibGUsXHJcbiAgICAgICAgICBlbGVtZW50OiB0aGlzLmNvbnRlbnQubmF0aXZlRWxlbWVudCxcclxuICAgICAgICAgIGZlYXR1cmU6IHRoaXMuZmVhdHVyZSxcclxuICAgICAgICAgIGxuZ0xhdDogdGhpcy5sbmdMYXQsXHJcbiAgICAgICAgICBjbGlja1RvbGVyYW5jZTogdGhpcy5jbGlja1RvbGVyYW5jZSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1hcmtlcnNFdmVudHM6IHtcclxuICAgICAgICAgIG1hcmtlckRyYWdTdGFydDogdGhpcy5tYXJrZXJEcmFnU3RhcnQsXHJcbiAgICAgICAgICBtYXJrZXJEcmFnOiB0aGlzLm1hcmtlckRyYWcsXHJcbiAgICAgICAgICBtYXJrZXJEcmFnRW5kOiB0aGlzLm1hcmtlckRyYWdFbmQsXHJcbiAgICAgICAgICBkcmFnU3RhcnQ6IHRoaXMuZHJhZ1N0YXJ0LFxyXG4gICAgICAgICAgZHJhZzogdGhpcy5kcmFnLFxyXG4gICAgICAgICAgZHJhZ0VuZDogdGhpcy5kcmFnRW5kLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuTWFwU2VydmljZS5yZW1vdmVNYXJrZXIodGhpcy5tYXJrZXJJbnN0YW5jZSEpO1xyXG4gICAgdGhpcy5tYXJrZXJJbnN0YW5jZSA9IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIHRvZ2dsZVBvcHVwKCkge1xyXG4gICAgdGhpcy5tYXJrZXJJbnN0YW5jZSEudG9nZ2xlUG9wdXAoKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUNvb3JkaW5hdGVzKGNvb3JkaW5hdGVzOiBudW1iZXJbXSkge1xyXG4gICAgdGhpcy5tYXJrZXJJbnN0YW5jZSEuc2V0TG5nTGF0KDxbbnVtYmVyLCBudW1iZXJdPmNvb3JkaW5hdGVzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgd2FybkRlcHJlY2F0ZWRPdXRwdXRzKCkge1xyXG4gICAgY29uc3QgZHcgPSBkZXByZWNhdGlvbldhcm5pbmcuYmluZCh1bmRlZmluZWQsIE1hcmtlckNvbXBvbmVudC5uYW1lKTtcclxuICAgIGlmICh0aGlzLmRyYWdTdGFydC5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgIGR3KCdkcmFnU3RhcnQnLCAnbWFya2VyRHJhZ1N0YXJ0Jyk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5kcmFnRW5kLm9ic2VydmVycy5sZW5ndGgpIHtcclxuICAgICAgZHcoJ2RyYWdFbmQnLCAnbWFya2VyRHJhZ0VuZCcpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZHJhZy5vYnNlcnZlcnMubGVuZ3RoKSB7XHJcbiAgICAgIGR3KCdkcmFnJywgJ21hcmtlckRyYWcnKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19